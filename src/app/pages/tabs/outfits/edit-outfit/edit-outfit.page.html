<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-title class="ion-text-center">Edit outfit</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="goBack()" fill="clear" class="body1-regular">
        Cancel
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Show loading state -->
  <div *ngIf="isLoading" class="create-outfit-container column-stack-lg pad-all-md">
    <!-- Upper Garments Section Skeleton -->
    <div class="outfit-section column-stack-sm">
      <app-skeleton-loader type="text" [width]="'40%'" [height]="'18px'" [borderRadius]="'4px'"></app-skeleton-loader>
      <div class="garments-row row-stack-sm">
        <div class="garment-item-wrapper">
          <app-skeleton-loader type="image" [width]="'100%'" [height]="'100%'" [borderRadius]="'12px'"></app-skeleton-loader>
        </div>
        <div class="garment-placeholder-skeleton">
          <app-skeleton-loader type="image" [width]="'100%'" [height]="'100%'" [borderRadius]="'12px'"></app-skeleton-loader>
        </div>
      </div>
    </div>

    <!-- Bottoms Section Skeleton -->
    <div class="outfit-section column-stack-sm">
      <app-skeleton-loader type="text" [width]="'30%'" [height]="'18px'" [borderRadius]="'4px'"></app-skeleton-loader>
      <div class="garments-row row-stack-sm">
        <div class="garment-item-wrapper">
          <app-skeleton-loader type="image" [width]="'100%'" [height]="'100%'" [borderRadius]="'12px'"></app-skeleton-loader>
        </div>
        <div class="garment-placeholder-skeleton">
          <app-skeleton-loader type="image" [width]="'100%'" [height]="'100%'" [borderRadius]="'12px'"></app-skeleton-loader>
        </div>
      </div>
    </div>

    <!-- Shoes Section Skeleton -->
    <div class="outfit-section column-stack-sm">
      <app-skeleton-loader type="text" [width]="'25%'" [height]="'18px'" [borderRadius]="'4px'"></app-skeleton-loader>
      <div class="garments-row row-stack-sm">
        <div class="garment-item-wrapper">
          <app-skeleton-loader type="image" [width]="'100%'" [height]="'100%'" [borderRadius]="'12px'"></app-skeleton-loader>
        </div>
        <div class="garment-placeholder-skeleton">
          <app-skeleton-loader type="image" [width]="'100%'" [height]="'100%'" [borderRadius]="'12px'"></app-skeleton-loader>
        </div>
      </div>
    </div>

    <!-- Accessories Section Skeleton -->
    <div class="outfit-section column-stack-sm">
      <app-skeleton-loader type="text" [width]="'35%'" [height]="'18px'" [borderRadius]="'4px'"></app-skeleton-loader>
      <div class="garments-row row-stack-sm">
        <div class="garment-item-wrapper">
          <app-skeleton-loader type="image" [width]="'100%'" [height]="'100%'" [borderRadius]="'12px'"></app-skeleton-loader>
        </div>
        <div class="garment-placeholder-skeleton">
          <app-skeleton-loader type="image" [width]="'100%'" [height]="'100%'" [borderRadius]="'12px'"></app-skeleton-loader>
        </div>
      </div>
    </div>

    <!-- Custom Name Section Skeleton -->
    <div class="outfit-section column-stack-sm">
      <app-skeleton-loader type="text" [width]="'35%'" [height]="'18px'" [borderRadius]="'4px'"></app-skeleton-loader>
      <div class="name-input-skeleton">
        <app-skeleton-loader type="text" [width]="'100%'" [height]="'20px'" [borderRadius]="'4px'"></app-skeleton-loader>
      </div>
    </div>

    <!-- Save Button Skeleton -->
    <div class="create-button-container">
      <app-skeleton-loader type="text" [width]="'100%'" [height]="'48px'" [borderRadius]="'8px'"></app-skeleton-loader>
    </div>
  </div>

  <!-- Show outfit edit form -->
  <div *ngIf="!isLoading" class="create-outfit-container column-stack-lg pad-all-md">
    
    <!-- Upper Garments Section -->
    <div class="outfit-section column-stack-sm">
      <h3 class="section-title body1-medium">Upper garments</h3>
      <div class="garments-row row-stack-sm">
        <!-- Selected Garments -->
        <div 
          *ngFor="let garment of getSelectedGarments('upper-garments')"
          class="garment-item-wrapper"
        >
          <div class="garment-item-container">
            <img 
              [src]="garment.imageUrl"
              [alt]="garment.subtype"
              class="selected-garment-image"
            />
            <button 
              class="remove-button"
              (click)="removeGarment('upper-garments', garment.id); $event.stopPropagation()"
            >
              <app-icon name="close" [size]="16" [color]="'var(--ion-color-primary)'"></app-icon>
            </button>
          </div>
        </div>
        <!-- Add Button -->
        <div 
          class="garment-placeholder items-center justify-center"
          (click)="openGarmentModal('upper-garments')"
        >
          <div class="placeholder-content items-center justify-center">
            <app-icon name="add" [size]="32" [color]="'var(--ion-color-primary)'"></app-icon>
          </div>
        </div>
      </div>
    </div>

    <!-- Bottoms Section -->
    <div class="outfit-section column-stack-sm">
      <h3 class="section-title body1-medium">Bottoms</h3>
      <div class="garments-row row-stack-sm">
        <!-- Selected Garments -->
        <div 
          *ngFor="let garment of getSelectedGarments('bottoms')"
          class="garment-item-wrapper"
        >
          <div class="garment-item-container">
            <img 
              [src]="garment.imageUrl"
              [alt]="garment.subtype"
              class="selected-garment-image"
            />
            <button 
              class="remove-button"
              (click)="removeGarment('bottoms', garment.id); $event.stopPropagation()"
            >
              <app-icon name="close" [size]="16" [color]="'var(--ion-color-primary)'"></app-icon>
            </button>
          </div>
        </div>
        <!-- Add Button -->
        <div 
          class="garment-placeholder items-center justify-center"
          (click)="openGarmentModal('bottoms')"
        >
          <div class="placeholder-content items-center justify-center">
            <app-icon name="add" [size]="32" [color]="'var(--ion-color-primary)'"></app-icon>
          </div>
        </div>
      </div>
    </div>

    <!-- Shoes Section -->
    <div class="outfit-section column-stack-sm">
      <h3 class="section-title body1-medium">Shoes</h3>
      <div class="garments-row row-stack-sm">
        <!-- Selected Garments -->
        <div 
          *ngFor="let garment of getSelectedGarments('shoes')"
          class="garment-item-wrapper"
        >
          <div class="garment-item-container">
            <img 
              [src]="garment.imageUrl"
              [alt]="garment.subtype"
              class="selected-garment-image"
            />
            <button 
              class="remove-button"
              (click)="removeGarment('shoes', garment.id); $event.stopPropagation()"
            >
              <app-icon name="close" [size]="16" [color]="'var(--ion-color-primary)'"></app-icon>
            </button>
          </div>
        </div>
        <!-- Add Button -->
        <div 
          class="garment-placeholder items-center justify-center"
          (click)="openGarmentModal('shoes')"
        >
          <div class="placeholder-content items-center justify-center">
            <app-icon name="add" [size]="32" [color]="'var(--ion-color-primary)'"></app-icon>
          </div>
        </div>
      </div>
    </div>

    <!-- Accessories Section -->
    <div class="outfit-section column-stack-sm">
      <h3 class="section-title body1-medium">Accessories</h3>
      <div class="garments-row row-stack-sm">
        <!-- Selected Garments -->
        <div 
          *ngFor="let garment of getSelectedGarments('accessories')"
          class="garment-item-wrapper"
        >
          <div class="garment-item-container">
            <img 
              [src]="garment.imageUrl"
              [alt]="garment.subtype"
              class="selected-garment-image"
            />
            <button 
              class="remove-button"
              (click)="removeGarment('accessories', garment.id); $event.stopPropagation()"
            >
              <app-icon name="close" [size]="16" [color]="'var(--ion-color-primary)'"></app-icon>
            </button>
          </div>
        </div>
        <!-- Add Button -->
        <div 
          class="garment-placeholder items-center justify-center"
          (click)="openGarmentModal('accessories')"
        >
          <div class="placeholder-content items-center justify-center">
            <app-icon name="add" [size]="32" [color]="'var(--ion-color-primary)'"></app-icon>
          </div>
        </div>
      </div>
    </div>

    <!-- Custom Name Section -->
    <div class="outfit-section column-stack-sm">
      <h3 class="section-title body1-medium">Custom name</h3>
      <ion-item class="name-input-item">
        <ion-input
          [(ngModel)]="outfitName"
          placeholder="Enter outfit name"
          class="outfit-name-input"
        ></ion-input>
      </ion-item>
    </div>

    <!-- Save Outfit Button -->
    <div class="create-button-container">
      <app-button
        variant="primary"
        size="large"
        [fullWidth]="true"
        [disabled]="!canSaveOutfit || isSavingOutfit"
        (click)="onSaveOutfit()"
      >
        Save outfit
      </app-button>
    </div>

  </div>
</ion-content>

<ion-toast
  [isOpen]="isToastOpen"
  [message]="toastMessage"
  [duration]="toastDuration"
  [color]="toastColor"
  position="bottom"
  (didDismiss)="onToastDidDismiss()"
></ion-toast>
